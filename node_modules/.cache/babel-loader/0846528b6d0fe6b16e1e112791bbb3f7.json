{"ast":null,"code":"// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT License. See License.txt in the project root for license information.\nimport { __awaiter, __generator } from \"tslib\";\nimport { Constants as MSRestConstants } from \"../util/constants\";\nvar DEFAULT_AUTHORIZATION_SCHEME = \"Bearer\";\n/**\n * This class provides a simple extension to use {@link TokenCredential} from `@azure/identity` library to\n * use with legacy Azure SDKs that accept {@link ServiceClientCredentials} family of credentials for authentication.\n */\n\nvar AzureIdentityCredentialAdapter =\n/** @class */\nfunction () {\n  function AzureIdentityCredentialAdapter(azureTokenCredential, scopes) {\n    if (scopes === void 0) {\n      scopes = \"https://management.azure.com/.default\";\n    }\n\n    this.azureTokenCredential = azureTokenCredential;\n    this.scopes = scopes;\n  }\n\n  AzureIdentityCredentialAdapter.prototype.getToken = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var accessToken, result;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.azureTokenCredential.getToken(this.scopes)];\n\n          case 1:\n            accessToken = _a.sent();\n\n            if (accessToken !== null) {\n              result = {\n                accessToken: accessToken.token,\n                tokenType: DEFAULT_AUTHORIZATION_SCHEME,\n                expiresOn: accessToken.expiresOnTimestamp\n              };\n              return [2\n              /*return*/\n              , result];\n            } else {\n              throw new Error(\"Could find token for scope\");\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  AzureIdentityCredentialAdapter.prototype.signRequest = function (webResource) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenResponse;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getToken()];\n\n          case 1:\n            tokenResponse = _a.sent();\n            webResource.headers.set(MSRestConstants.HeaderConstants.AUTHORIZATION, tokenResponse.tokenType + \" \" + tokenResponse.accessToken);\n            return [2\n            /*return*/\n            , Promise.resolve(webResource)];\n        }\n      });\n    });\n  };\n\n  return AzureIdentityCredentialAdapter;\n}();\n\nexport { AzureIdentityCredentialAdapter };","map":{"version":3,"sources":["../../../lib/credentials/azureIdentityTokenCredentialAdapter.ts"],"names":[],"mappings":"AAAA;AACA;;AAGA,SAAS,SAAS,IAAI,eAAtB,QAA6C,mBAA7C;AAMA,IAAM,4BAA4B,GAAG,QAArC;AAEA;;;AAGG;;AACH,IAAA,8BAAA;AAAA;AAAA,YAAA;AAIE,WAAA,8BAAA,CACE,oBADF,EAEE,MAFF,EAEqE;AAAnE,QAAA,MAAA,KAAA,KAAA,CAAA,EAAA;AAAA,MAAA,MAAA,GAAA,uCAAA;AAAmE;;AAEnE,SAAK,oBAAL,GAA4B,oBAA5B;AACA,SAAK,MAAL,GAAc,MAAd;AACD;;AAEY,EAAA,8BAAA,CAAA,SAAA,CAAA,QAAA,GAAb,YAAA;;;;;;AACsB,mBAAA,CAAA;AAAA;AAAA,cAAM,KAAK,oBAAL,CAA0B,QAA1B,CAAmC,KAAK,MAAxC,CAAN,CAAA;;;AAAd,YAAA,WAAW,GAAG,EAAA,CAAA,IAAA,EAAd;;AACN,gBAAI,WAAW,KAAK,IAApB,EAA0B;AAClB,cAAA,MAAM,GAAkB;AAC5B,gBAAA,WAAW,EAAE,WAAW,CAAC,KADG;AAE5B,gBAAA,SAAS,EAAE,4BAFiB;AAG5B,gBAAA,SAAS,EAAE,WAAW,CAAC;AAHK,eAAxB;AAKN,qBAAA,CAAA;AAAA;AAAA,gBAAO,MAAP,CAAA;AACD,aAPD,MAOO;AACL,oBAAM,IAAI,KAAJ,CAAU,4BAAV,CAAN;AACD;;;;;;;;AACF,GAZY;;AAcA,EAAA,8BAAA,CAAA,SAAA,CAAA,WAAA,GAAb,UAAyB,WAAzB,EAAiD;;;;;;AACzB,mBAAA,CAAA;AAAA;AAAA,cAAM,KAAK,QAAL,EAAN,CAAA;;;AAAhB,YAAA,aAAa,GAAG,EAAA,CAAA,IAAA,EAAhB;AACN,YAAA,WAAW,CAAC,OAAZ,CAAoB,GAApB,CACE,eAAe,CAAC,eAAhB,CAAgC,aADlC,EAEK,aAAa,CAAC,SAAd,GAAuB,GAAvB,GAA2B,aAAa,CAAC,WAF9C;AAIA,mBAAA,CAAA;AAAA;AAAA,cAAO,OAAO,CAAC,OAAR,CAAgB,WAAhB,CAAP,CAAA;;;;AACD,GAPY;;AAQf,SAAA,8BAAA;AAAC,CAlCD,EAAA","sourceRoot":"","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT License. See License.txt in the project root for license information.\nimport { __awaiter, __generator } from \"tslib\";\nimport { Constants as MSRestConstants } from \"../util/constants\";\nvar DEFAULT_AUTHORIZATION_SCHEME = \"Bearer\";\n/**\n * This class provides a simple extension to use {@link TokenCredential} from `@azure/identity` library to\n * use with legacy Azure SDKs that accept {@link ServiceClientCredentials} family of credentials for authentication.\n */\nvar AzureIdentityCredentialAdapter = /** @class */ (function () {\n    function AzureIdentityCredentialAdapter(azureTokenCredential, scopes) {\n        if (scopes === void 0) { scopes = \"https://management.azure.com/.default\"; }\n        this.azureTokenCredential = azureTokenCredential;\n        this.scopes = scopes;\n    }\n    AzureIdentityCredentialAdapter.prototype.getToken = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var accessToken, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.azureTokenCredential.getToken(this.scopes)];\n                    case 1:\n                        accessToken = _a.sent();\n                        if (accessToken !== null) {\n                            result = {\n                                accessToken: accessToken.token,\n                                tokenType: DEFAULT_AUTHORIZATION_SCHEME,\n                                expiresOn: accessToken.expiresOnTimestamp,\n                            };\n                            return [2 /*return*/, result];\n                        }\n                        else {\n                            throw new Error(\"Could find token for scope\");\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AzureIdentityCredentialAdapter.prototype.signRequest = function (webResource) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenResponse;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getToken()];\n                    case 1:\n                        tokenResponse = _a.sent();\n                        webResource.headers.set(MSRestConstants.HeaderConstants.AUTHORIZATION, tokenResponse.tokenType + \" \" + tokenResponse.accessToken);\n                        return [2 /*return*/, Promise.resolve(webResource)];\n                }\n            });\n        });\n    };\n    return AzureIdentityCredentialAdapter;\n}());\nexport { AzureIdentityCredentialAdapter };\n//# sourceMappingURL=azureIdentityTokenCredentialAdapter.js.map"]},"metadata":{},"sourceType":"module"}